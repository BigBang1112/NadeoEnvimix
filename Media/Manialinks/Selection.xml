<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<manialink version="3">
<quad pos="0 0" z-index="0" size="270 100" bgcolor="000A" halign="center" valign="center"/>
<frame z-index="1" id="selection">
<frame pos="-130 45" id="SelectionCanyon">
	<quad size="50 90" bgcolor="888A" image="file://Media/CanyonSelect.jpg"/>
	<quad size="50 90" bgcolor="FFFA" scriptevents="1" z-index="1" id="button"/>
	<quad pos="25 -2" z-index="2" size="45 10" bgcolor="000A" halign="center"/>
	<label pos="25 -5" z-index="3" size="45 5" text="Canyon Car" halign="center" style="TextTitle3" textsize="3"/>
	<label pos="25 -15" z-index="2" size="40 5" text="---" halign="center" textfont="RajdhaniMono" id="PB"/>
	<label pos="25 -72" z-index="1" size="50 5" text="Difficulty" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -75" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Difficulty"/>
	<label pos="25 -82" z-index="1" size="50 5" text="Quality" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -85" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Quality"/>
	
	<frame id="Default" z-index="2" hidden="1">
		<quad pos="0 0" size="50 90" bgcolor="000A" scriptevents="1"/>
		<label pos="25 -46.5" z-index="1" size="40 20" text="Original maps are unplayable" halign="center" valign="center2" style="TextTitle3" autonewline="1"/>
	</frame>
</frame>
<frame pos="-80 45" id="SelectionStadium">
	<quad size="50 90" bgcolor="888A" scriptevents="1" image="file://Media/StadiumSelect.jpg"/>
	<quad size="50 90" bgcolor="FFFA" scriptevents="1" id="button" z-index="1"/>
	<quad pos="25 -2" z-index="2" size="45 10" bgcolor="000A" halign="center"/>
	<label pos="25 -5" z-index="3" size="45 5" text="Stadium Car" halign="center" style="TextTitle3" textsize="3"/>
	<label pos="25 -15" z-index="2" size="40 5" text="---" halign="center" textfont="RajdhaniMono" id="PB"/>
	<label pos="25 -72" z-index="1" size="50 5" text="Difficulty" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -75" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Difficulty"/>
	<label pos="25 -82" z-index="1" size="50 5" text="Quality" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -85" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Quality"/>
	
	<frame id="Default" z-index="2" hidden="1">
		<quad pos="0 0" size="50 90" bgcolor="000A" scriptevents="1"/>
		<label pos="25 -46.5" z-index="1" size="40 20" text="Original maps are unplayable" halign="center" valign="center2" style="TextTitle3" autonewline="1"/>
	</frame>
</frame>
<frame pos="-30 45" id="SelectionValley">
	<quad size="50 90" bgcolor="888A" scriptevents="1" image="file://Media/ValleySelect.jpg"/>
	<quad size="50 90" bgcolor="FFFA" scriptevents="1" id="button" z-index="1"/>
	<quad pos="25 -2" z-index="3" size="45 10" bgcolor="000A" halign="center"/>
	<label pos="25 -5" z-index="4" size="45 5" text="Valley Car" halign="center" style="TextTitle3" textsize="3"/>
	<label pos="25 -15" z-index="2" size="40 5" text="---" halign="center" textfont="RajdhaniMono" id="PB"/>
	<label pos="25 -72" z-index="1" size="50 5" text="Difficulty" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -75" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Difficulty"/>
	<label pos="25 -82" z-index="1" size="50 5" text="Quality" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -85" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Quality"/>
	
	<frame id="Default" z-index="2" hidden="1">
		<quad pos="0 0" size="50 90" bgcolor="000A" scriptevents="1"/>
		<label pos="25 -46.5" z-index="1" size="40 20" text="Original maps are unplayable" halign="center" valign="center2" style="TextTitle3" autonewline="1"/>
	</frame>
</frame>
<frame pos="20 45" id="SelectionLagoon">
	<quad size="50 90" bgcolor="888A" scriptevents="1" image="file://Media/LagoonSelect.jpg"/>
	<quad size="50 90" bgcolor="FFFA" scriptevents="1" id="button" z-index="1"/>
	<quad pos="25 -2" z-index="2" size="45 10" bgcolor="000A" halign="center"/>
	<label pos="25 -5" z-index="3" size="45 5" text="Lagoon Car" halign="center" style="TextTitle3" textsize="3"/>
	<label pos="25 -15" z-index="2" size="40 5" text="---" halign="center" textfont="RajdhaniMono" id="PB"/>
	<label pos="25 -72" z-index="1" size="50 5" text="Difficulty" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -75" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Difficulty"/>
	<label pos="25 -82" z-index="1" size="50 5" text="Quality" style="TextTitle3" valign="center" halign="center" textsize="1"/>
	<gauge pos="25 -85" z-index="1" size="45 10" ratio=".5" drawbg="0" style="EnergyBar" halign="center" valign="center" id="Quality"/>
	
	<frame id="Default" z-index="2" hidden="1">
		<quad pos="0 0" size="50 90" bgcolor="000A" scriptevents="1"/>
		<label pos="25 -46.5" z-index="1" size="40 20" text="Original maps are unplayable" halign="center" valign="center2" style="TextTitle3" autonewline="1"/>
	</frame>
</frame>
</frame>

<quad pos="75 45" z-index="1" size="3 90" bgcolor="000A" halign="center"/>
<frame hidden="1" z-index="1">
	<quad pos="80 45" z-index="1" size="50 65" bgcolor="000A"/>
	<label pos="105 40" z-index="2" size="50 5" text="Custom car" autonewline="1" style="TextTitle3" textsize="2.5" halign="center"/>
</frame>
<frame id="buttons" z-index="2">
<frame pos="105 28" id="buttonCar1" hidden="1">
	<quad pos="0 0" z-index="0" size="50 8" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="45 8" text="..." halign="center" valign="center2" z-index="1" id="text" textsize="1"/>
</frame>
<frame pos="105 18" id="buttonCar2" hidden="1">
	<quad pos="0 0" z-index="0" size="50 8" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="45 8" text="..." halign="center" valign="center2" z-index="1" id="text" textsize="1"/>
</frame>
<frame pos="105 8" id="buttonCar3" hidden="1">
	<quad pos="0 0" z-index="0" size="50 8" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="45 8" text="..." halign="center" valign="center2" z-index="1" id="text" textsize="1"/>
</frame>
<frame pos="105 -2" id="buttonCar4" hidden="1">
	<quad pos="0 0" z-index="0" size="50 8" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="45 8" text="..." halign="center" valign="center2" z-index="1" id="text" textsize="1"/>
</frame>
<frame pos="105 -12" id="buttonCar5" hidden="1">
	<quad pos="0 0" z-index="0" size="50 8" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="45 8" text="..." halign="center" valign="center2" z-index="1" id="text" textsize="1"/>
</frame>

<frame pos="105 -28" id="buttonSpectate">
	<quad pos="0 0" z-index="0" size="50 10" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="30 5" text="Spectate" style="TextTitle3" halign="center" valign="center2" z-index="1" id="text"/>
</frame>
<frame pos="105 -40" id="buttonExit">
	<quad pos="0 0" z-index="0" size="50 10" bgcolor="000F" halign="center" valign="center" scriptevents="1" id="button"/>
	<label size="30 5" text="Exit" style="TextTitle3" halign="center" valign="center2" z-index="1" id="text"/>
</frame>
</frame>
<script>
	<!--
		#Include "TextLib" as TextLib
		#Include "MathLib" as MathLib
		#Include "AnimLib" as AnimLib
		
		declare SoundHover = Audio.CreateSound("file://Media/Sounds/Hover.ogg");
		declare SoundClick = Audio.CreateSound("file://Media/Sounds/Click.ogg");
		declare SoundElectric = Audio.CreateSound("file://Media/Sounds/Electric.ogg");
		
		declare MapRequest = Http.CreateGet("http://trackmania.bigbang1112.eu/nadeoenvimix/api/map.php?id=" ^ Map.MapInfo.MapUid);
		
		declare persistent Text[] NEM_CustomCars for LocalUser;
		
		if(NEM_CustomCars.count == 0) {
			for(i,0,4) {
				NEM_CustomCars.add("");
			}
		}
		
		for(i,1,5) {
			if(NEM_CustomCars[i-1] == "")
				((Page.GetFirstChild("buttonCar"^i) as CMlFrame).GetFirstChild("text") as CMlLabel).SetText("...");
			else
				((Page.GetFirstChild("buttonCar"^i) as CMlFrame).GetFirstChild("text") as CMlLabel).SetText(NEM_CustomCars[i-1]);
		}
	
		while(True) {
			declare netread Integer[] Net_Records for UI;
			
			((Page.GetFirstChild("SelectionCanyon") as CMlFrame).GetFirstChild("PB") as CMlLabel).SetText(TextLib::TimeToText(Net_Records[0],True)^TextLib::SubText(""^Net_Records[0],TextLib::Length(""^Net_Records[0])-1,1));
			((Page.GetFirstChild("SelectionStadium") as CMlFrame).GetFirstChild("PB") as CMlLabel).SetText(TextLib::TimeToText(Net_Records[1],True)^TextLib::SubText(""^Net_Records[1],TextLib::Length(""^Net_Records[1])-1,1));
			((Page.GetFirstChild("SelectionValley") as CMlFrame).GetFirstChild("PB") as CMlLabel).SetText(TextLib::TimeToText(Net_Records[2],True)^TextLib::SubText(""^Net_Records[2],TextLib::Length(""^Net_Records[2])-1,1));
			((Page.GetFirstChild("SelectionLagoon") as CMlFrame).GetFirstChild("PB") as CMlLabel).SetText(TextLib::TimeToText(Net_Records[3],True)^TextLib::SubText(""^Net_Records[3],TextLib::Length(""^Net_Records[3])-1,1));
		
			if(MapRequest != Null) {
				if(MapRequest.IsCompleted) {
					if(MapRequest.StatusCode == 200) {
						
					}
					else {
						
					}
					
					Http.Destroy(MapRequest);
					MapRequest = Null;
				}
			}
			
			declare netread Text Net_MapCar for UI;
			
			switch(Net_MapCar) {
				case "CanyonCar": {
					(Page.GetFirstChild("SelectionCanyon") as CMlFrame).GetFirstChild("Default").Show();
				}
				case "StadiumCar": {
					(Page.GetFirstChild("SelectionStadium") as CMlFrame).GetFirstChild("Default").Show();
				}
				case "ValleyCar": {
					(Page.GetFirstChild("SelectionValley") as CMlFrame).GetFirstChild("Default").Show();
				}
				case "LagoonCar": {
					(Page.GetFirstChild("SelectionLagoon") as CMlFrame).GetFirstChild("Default").Show();
				}
			}
		
			foreach(Car,(Page.GetFirstChild("selection") as CMlFrame).Controls) {
				declare Time = TextLib::ToInteger(Car.DataAttributeGet("hover_time"));
				declare Value = AnimLib::EaseOutCubic(Now - Time, 0.0, 1.0, 200);
				
				if(Car.DataAttributeGet("hover") == "true") {
					((Car as CMlFrame).GetFirstChild("button") as CMlQuad).Opacity = Value * .25;
				}
				else {
					((Car as CMlFrame).GetFirstChild("button") as CMlQuad).Opacity = .25 - Value * .25;
				}
			}
			
			foreach(Button,(Page.GetFirstChild("buttons") as CMlFrame).Controls) {
				declare B <=> (Button as CMlFrame);
				
				declare Time = TextLib::ToInteger(B.DataAttributeGet("hover_time"));
				declare Value = AnimLib::EaseOutCubic(Now - Time, 0.0, 1.0, 200);
				
				if(B.DataAttributeGet("hover") == "true") {
					(B.GetFirstChild("button") as CMlQuad).BgColor = <Value,Value,Value>;
					(B.GetFirstChild("text") as CMlLabel).TextColor = <1.0-Value,1.0-Value,1.0-Value>;
				}
				else {
					(B.GetFirstChild("button") as CMlQuad).BgColor = <1.0-Value,1.0-Value,1.0-Value>;
					(B.GetFirstChild("text") as CMlLabel).TextColor = <Value,Value,Value>;
				}
			}
			
			foreach(Event,PendingEvents) {
				switch(Event.Type) {
					case CMlEvent::Type::MouseOver: {
						declare Frame <=> Event.Control.Parent;
					
						if(Event.ControlId == "button") {
							Audio.PlaySoundEvent(SoundHover, 1.0);
							Frame.DataAttributeSet("hover","true");
							Frame.DataAttributeSet("hover_time",Now^"");
							Frame.DataAttributeSet("hover_in_value",(Event.Control as CMlQuad).BgColor[0]^"");
						}
					}
					case CMlEvent::Type::MouseOut: {
						declare Frame <=> Event.Control.Parent;
					
						if(Event.ControlId == "button") {
							Frame.DataAttributeSet("hover","false");
							Frame.DataAttributeSet("hover_time",Now^"");
							Frame.DataAttributeSet("hover_out_value",(Event.Control as CMlQuad).BgColor[0]^"");
						}
					}
					case CMlScriptEvent::Type::MouseClick: {
						if(Event.Control.Parent.ControlId == "SelectionCanyon"
						|| Event.Control.Parent.ControlId == "SelectionStadium"
						|| Event.Control.Parent.ControlId == "SelectionValley"
						|| Event.Control.Parent.ControlId == "SelectionLagoon") {
						
							declare netwrite Text Net_Vehicle for UI;
							
							switch(Event.Control.Parent.ControlId) {
								case "SelectionCanyon": { Net_Vehicle = "CanyonCar"; }
								case "SelectionStadium": { Net_Vehicle = "StadiumCar"; }
								case "SelectionValley": { Net_Vehicle = "ValleyCar"; }
								case "SelectionLagoon": { Net_Vehicle = "LagoonCar"; }
							}
					
							declare netwrite Text Net_State for UI;
							Net_State = "START";
						}
						
						if(Event.Control.Parent.ControlId == "buttonCar1"
						|| Event.Control.Parent.ControlId == "buttonCar2"
						|| Event.Control.Parent.ControlId == "buttonCar3"
						|| Event.Control.Parent.ControlId == "buttonCar4"
						|| Event.Control.Parent.ControlId == "buttonCar5") {
							declare netwrite Text Net_Vehicle for UI;
							
							switch(Event.Control.Parent.ControlId) {
								case "buttonCar1": { Net_Vehicle = NEM_CustomCars[0]; }
								case "buttonCar2": { Net_Vehicle = NEM_CustomCars[1]; }
								case "buttonCar3": { Net_Vehicle = NEM_CustomCars[2]; }
								case "buttonCar4": { Net_Vehicle = NEM_CustomCars[3]; }
								case "buttonCar5": { Net_Vehicle = NEM_CustomCars[4]; }
							}
					
							declare netwrite Text Net_State for UI;
							Net_State = "START";
						}
						
						if(Event.Control.Parent.ControlId == "buttonSpectate") {
							declare netwrite Text Net_State for UI;
							Net_State = "SPECTATE";
						}
						if(Event.Control.Parent.ControlId == "buttonExit") {
							declare netwrite Text Net_State for UI;
							Net_State = "BACK";
						}
					}
				}
			}
			yield;
		}
	-->
</script>
</manialink>